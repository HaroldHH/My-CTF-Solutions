'''
>> nc crypto.chall.pwnoh.io 13374
I'm going to send you the flag.
However, I noticed that an FBI agent has been eavesdropping on my messages,
so I'm going to send it to you in a way that ONLY YOU can decrypt the flag.

p = 8306058041545788499910397103628706562175826980764973801754831905168811135606703584864698869566625449496065016850672525800272637844054388491774498074839163
g = 5
A = 7451349891834586093461214213379103569145604584975454553439866574937375432494109688496591119658202248482690327469721623529285857341328052559435044625059200
Give me your public key B: 125
ciphertext = 30f254a9e370b0bc541ef13fd659b399a2be371b14cdc303ab6828840c420882305667b8dc179b33f89ef46985c4ef295ce8a45356cad3f5bfaa01851fd3f2aa
'''

import random
import hashlib
import Crypto.Util.number as cun
from Crypto.Cipher import AES

p = 8306058041545788499910397103628706562175826980764973801754831905168811135606703584864698869566625449496065016850672525800272637844054388491774498074839163
g = 5
A = 7451349891834586093461214213379103569145604584975454553439866574937375432494109688496591119658202248482690327469721623529285857341328052559435044625059200
B = 125
b = 3
shared_secret = pow(A, b, p)

ciphertext = bytes.fromhex("30f254a9e370b0bc541ef13fd659b399a2be371b14cdc303ab6828840c420882305667b8dc179b33f89ef46985c4ef295ce8a45356cad3f5bfaa01851fd3f2aa")

key = hashlib.sha1(cun.long_to_bytes(shared_secret)).digest()[:16]
plain = AES.new(key, AES.MODE_ECB)
plaintext = plain.decrypt(ciphertext)
print(f"Flag = {plaintext}")
